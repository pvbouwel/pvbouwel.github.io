<!doctype html><html lang=en><head><title>Belgium eid authentication in Firefox · Allinthemiddle</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="pvbouwel"><meta name=description content="Authentication via Belgian eID card with Mozilla Firefox on Linux"><meta name=keywords content="blog,devops,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Belgium eid authentication in Firefox"><meta name=twitter:description content="Authentication via Belgian eID card with Mozilla Firefox on Linux"><meta property="og:url" content="http://pvbouwel.github.io/posts/be-eid-firefox-auth/"><meta property="og:site_name" content="Allinthemiddle"><meta property="og:title" content="Belgium eid authentication in Firefox"><meta property="og:description" content="Authentication via Belgian eID card with Mozilla Firefox on Linux"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-23T13:24:51+02:00"><meta property="article:modified_time" content="2022-01-23T13:24:51+02:00"><meta property="article:tag" content="Security"><meta property="article:tag" content="Belgium"><meta property="article:tag" content="Linux"><link rel=canonical href=http://pvbouwel.github.io/posts/be-eid-firefox-auth/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.6445a802b9389c9660e1b07b724dcf5718b1065ed2d71b4eeaf981cc7cc5fc46.css integrity="sha256-ZEWoArk4nJZg4bB7ck3PVxixBl7S1xtO6vmBzHzF/EY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/img/favicon.svg sizes=any><link rel=icon type=image/png href=/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=http://pvbouwel.github.io/>Allinthemiddle
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=http://pvbouwel.github.io/posts/be-eid-firefox-auth/>Belgium eid authentication in Firefox</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2022-01-23T13:24:51+02:00>January 23, 2022
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
7-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/security/>Security</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/belgium/>Belgium</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/linux/>Linux</a></span></div></div></header><div class=post-content><h1 id=update-outdated-warning>UPDATE: outdated warning
<a class=heading-link href=#update-outdated-warning><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>By now the issues have been fixed upstream this post purely remains as documentation in case it has value for someone going on his own troubleshooting journey.</p><h1 id=intro>Intro
<a class=heading-link href=#intro><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Since 2003 the Belgian government issues electronic identity cards called &ldquo;eID&rdquo; cards. These cards have cryptographic keys on them that allow digital signatures. This enables you to authenticate to government e-services using a smart card reader, your eID and pin (which you have to set when you receive your eID card). While setting up the software on Windows is straight forward I found the process for Linux less trivial hence I like to documented it.</p><p>So if you want to use your eID card to login to Belgian governmental services on Linux you can use this as a guide. My setup is a Linux Mind 20.3 &ldquo;Una&rdquo; which was not considered a support OS at time of writing (20.2 &ldquo;Uma&rdquo; was) so these instructions should not be limited to supported OS-es.</p><h1 id=the-well-documented-part>The well documented part
<a class=heading-link href=#the-well-documented-part><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>In order to be able to authenticate using an eID you need some middleware on your computer. This middleware provides the interface between your browser plugin and your eID in the smartcard reader. This section describes the installation of this middleware.</p><p>This piece of software is available via <a href=https://eid.belgium.be class=external-link target=_blank rel=noopener>https://eid.belgium.be</a> and at time of writing the Linux version can be found at <a href=https://eid.belgium.be/en/linux-eid-software-installatie class=external-link target=_blank rel=noopener>https://eid.belgium.be/en/linux-eid-software-installatie</a> . I do appreciate that they have tried to support a variety popular Linux distributions but what I respect most is their decision to have it available as opensource. In my case I used a newer release of Mint and therefore I downloaded the tarbal from the link under &ldquo;Downloads for unsupported distributions&rdquo;. Surprisingly they don&rsquo;t mention their github repo which has a better README.md. So I&rsquo;d advise to start there: <a href=https://github.com/Fedict/eid-mw class=external-link target=_blank rel=noopener>https://github.com/Fedict/eid-mw</a> or either just check out the instructions and use it to install the code packaged in the tarbal.</p><p>The github page details the pre-requisites. For my distribution I was able to install them using:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> sudo apt-get install libtool autoconf automake libassuan-dev autoconf-archive libpcsclite-dev libgtk-3-dev libcurl4-openssl-dev libproxy-dev libxml2 libp11-kit-dev openssl
</span></span></code></pre></div><p>Once you have the pre-requisites installed you can just use the commands from the github README.md to install the middleware:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> autoreconf -i
</span></span><span style=display:flex><span> ./configure  
</span></span><span style=display:flex><span> make 
</span></span><span style=display:flex><span> sudo make install
</span></span></code></pre></div><p>After this the middleware is installed. It comes with a binary application which you can run via the command <code>eid-viewer</code> and use to verify it is working correctly.
No card reader found</p><p>At this stage the application opened but the status bar at the bottom stated &ldquo;No cardreader found&rdquo; even when my cardreader was connected. Generally when a card reader is connected but no eID is inserted it should read &ldquo;Ready to read identity card&rdquo; but when testing just make sure to insert an eID card because the card reader might require this. In my case however I was stuck at &ldquo;no cardreader found&rdquo;.</p><p>The most likely explanation was that Linux didn&rsquo;t know how to communicate with my card reader and that it requires a device driver. Since it is a card reader that has many years I didn&rsquo;t have the documentation that came with it and the device itself only has a label &ldquo;Digipass by vasco&rdquo; which is too little to get a specific driver.</p><p>Fortunately Linux can help here. Since my smart cardreader is a USB device I can list all the USB devices and get there VendorId and ProductId using lsusb:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> lsusb
</span></span><span style=display:flex><span> ...
</span></span><span style=display:flex><span> Bus <span style=color:#a5d6ff>003</span> Device 006: ID 1a44:0001 VASCO Data Security International Digipass
</span></span><span style=display:flex><span> ...
</span></span></code></pre></div><p>When you Google this you arrive at the useful linux-hardware.org website (specifically <a href="https://linux-hardware.org/?id=usb:1a44-0001%29" class=external-link target=_blank rel=noopener>https://linux-hardware.org/?id=usb:1a44-0001)</a>. There they link to <a href=https://salsa.debian.org/rousseau/CCID class=external-link target=_blank rel=noopener>https://salsa.debian.org/rousseau/CCID</a> which is a driver that works with quite a lot of models. This time I found the instructions on the website more useful: (i.e. <a href=https://ccid.apdu.fr/ class=external-link target=_blank rel=noopener>https://ccid.apdu.fr/</a> ). It also seems that you can do a <code>sudo apt-get install libccid</code> but I only saw this package afterwards. In my case I have compiled from source.</p><p>If at this stage you still aren&rsquo;t able to check your card via <code>eid-viewer</code> then make sure to install <code>pcscd</code> which is a daemon that allows access to a smart card. You&rsquo;ll need it anyway at a later point. After installing you can also start the corresponding service:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> sudo apt-get install pcscd
</span></span><span style=display:flex><span> sudo service pcscd start
</span></span></code></pre></div><p>Hopefully at this stage you can open <code>eid-viewer</code> and see your card details.</p><h1 id=now-make-it-work-on-firefox>Now make it work on firefox
<a class=heading-link href=#now-make-it-work-on-firefox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>There is an official extension for firefox to make it work with firefox which is available at <a href=https://addons.mozilla.org/nl/firefox/addon/belgium-eid/ class=external-link target=_blank rel=noopener>https://addons.mozilla.org/nl/firefox/addon/belgium-eid/</a> .</p><p>However for me it always would notify me at startup with &ldquo;A recent enough version of the Belgian electronic identity card software could not be found. Is the eID software installed and up-to-date?&rdquo;.</p><p>I know the software is up-to-date since I have installed the latest version. This part required a bit more research so I&rsquo;ll split up in 2 sections; the explanation and the solution so you can skip to the solution if you are only interesting in getting yours working. If the solution doesn&rsquo;t work for you the explanation can give insights in how it works to aid troubleshooting on your end.</p><h2 id=the-explanation>The explanation
<a class=heading-link href=#the-explanation><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Whenever you get stuck you need to troubleshoot. One tool for troubleshooting is debugging. Recent versions of Firefox allows to debug extensions out of the box. If you browse to &ldquo;about:debugging&rdquo; then you get a debugging screen for Firefox, when you select &ldquo;This Firefox"then you can see all the extensions that are currently installed. When you click the &ldquo;inspect&rdquo; button for the &ldquo;eID Belgium&rdquo; plugin you&rsquo;ll get a screen (if you&rsquo;ve used developer tools from Firefox or Chrome this looks very familiar). There is a debugger tab in which you can find the main thread which runs &ldquo;background-script.js&rdquo;. This allows you to see what the plugin actually does. In this particular case it tries to install a pkcs11 security module. When that fails it shows the notification we saw earlier.</p><p>Since automatic installation doesn&rsquo;t work I thought let&rsquo;s do it manually and I followed instruction from <a href=https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/PKCS11/Module_Installation class=external-link target=_blank rel=noopener>https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/PKCS11/Module_Installation</a> and after I added the module I could see in security devices that Firefox can even see the attached card reader. Full of optimism I try a test login via <a href="https://iamapps.belgium.be/tma/?lang=en" class=external-link target=_blank rel=noopener>https://iamapps.belgium.be/tma/?lang=en</a> leading to a disappointing failed login.</p><p>The Firefox window to manage security devices gives very little configuration options but the issue at hand here is that the Firefox extension &ldquo;eID Belgium&rdquo; is not allowed to use the pkcs11 module that I imported manually. If you&rsquo;ve tried creating this security module manually you&rsquo;d want to delete it again because although it shows the cardreader it won&rsquo;t be usable and it will give rise to name conflict as you can only have one module named &ldquo;beidpkcs11&rdquo;.</p><p>The proper way to go about it is via a native manifest: <a href=https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_manifests#manifest_location class=external-link target=_blank rel=noopener>https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_manifests#manifest_location</a> . This manifest was actually built but it was put on /usr/local/lib/mozilla/pkcs11-modules/beidpkcs11.json which seems not checked by Firefox (perhaps in the past it was . There is also an alternate version that acts as a fallback /usr/local/lib/mozilla/pkcs11-modules/beidpkcs11_alt.json . This fallback uses p11-kit but in my case the first version works perfectly.</p><h2 id=the-solution>The solution
<a class=heading-link href=#the-solution><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Put the generated manifest on the location where Firefox expects it:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> sudo mkdir -p /usr/lib/mozilla/pkcs11-modules/
</span></span><span style=display:flex><span> sudo ln -s /usr/local/lib/mozilla/pkcs11-modules/beidpkcs11.json /usr/lib/mozilla/pkcs11-modules/beidpkcs11.json
</span></span></code></pre></div><p>Restart firefox and you should no longer see the notification pop-up and ideally the lights of your card reader are even blinking.</p><p>Note according to the docs the following 3 locations should be valid:</p><pre tabindex=0><code>  1. /usr/lib/mozilla/pkcs11-modules/beidpkcs11.json
  2. /usr/lib64/mozilla/pkcs11-modules/beidpkcs11.json
  3. ~/.mozilla/pkcs11-modules/beidpkcs11.json 
</code></pre><p>For me option 2 didn&rsquo;t work even though I&rsquo;m on Firefox 96.0.1 (64-bit). Option 1 & 3 both worked. So use 1 if you want it to be system-wide or option 3 if you only want it to be available for a specific user.</p><h2 id=the-final-test>The final test
<a class=heading-link href=#the-final-test><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Now go to <a href="https://iamapps.belgium.be/tma/?lang=en" class=external-link target=_blank rel=noopener>https://iamapps.belgium.be/tma/?lang=en</a> and you should be able to authenticate successfully!</p><p>Finally you can start the fun part; the filing of your taxes! Or whatever you wanted to do.</p><p>Edit: I wanted to create a PR to add the native manifest but it seems somebody has beaten me to it <a href=https://github.com/Fedict/eid-mw/commit/3ba426974e1b66d54b00b73cbe66137799ca80f3 class=external-link target=_blank rel=noopener>(with this change)</a>. So likely the next version will be easier to install.</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2009 -
2025
pvbouwel
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>